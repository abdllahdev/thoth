{% if type == "login" %}
import { useEffect, useState } from "react";
{% endif %}
{% if type == "signup" %}
import { useEffect } from "react";
{% endif %}
{% if type == "signup" or type == "login" %}
import { useNavigate } from "react-router";
{% endif %}
{% if requires_auth or type == "login" %}
import { User } from "../types";
{% endif %}
import Form from "../ui/Form";

const baseUrl = "http://localhost:4000";

const {{ id }} = () => {
  {% if requires_auth %}
  const storedUser = localStorage.getItem("user");
  const user: User | undefined = storedUser ? (JSON.parse(storedUser) as User) : undefined;
  {% endif %}

  const url = `${baseUrl}/{{ post_to }}`;
  {% if type == "signup" %}
  const navigate = useNavigate();
  useEffect(() => {
    if (localStorage.getItem("user")) {
      navigate("{{ on_success_redirect_to }}");
    }
  });
  {% endif %}

  {% if type == "login" %}
  const navigate = useNavigate();
  const [user, setUser] = useState<User>();

  const handleResponse = async (response: LoginResponse) => {
    localStorage.setItem("user", JSON.stringify(response));
    const storedUser = localStorage.getItem("user") as string;
    setUser(JSON.parse(storedUser) as User);
  };

  useEffect(() => {
    if (user) {
      navigate("{{ on_success_redirect_to }}");
    }
  }, [user]);
  {% endif %}

  return (
    <>
      <Form
        method={% if type == "create" or type == "signup" or type == "login" %}"POST"{% else %}"PUT"{% endif %}
        url={url}
        {% if requires_auth %}
        accessToken={user?.accessToken}
        {% endif %}
        formInputs={[
          {% for field in form_fields %}
            {
              {% for attr in field %}
                {{ attr.name }}: "{{ attr.value }}",
              {% endfor %}
            },
          {% endfor %}
        ]}
        formButton={{ "{{" }}
          {% for attr in form_button %}
            {{ attr.name }}: "{{ attr.value }}",
          {% endfor %}
        {{ "}}" }}
      />
    </>
  );
};

export default {{ id }};
