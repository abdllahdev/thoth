model User {
	id        Int     @id
	firstName String
	lastName  String
}

model Task {
	id        Int      @id
	title     String
	isDone    Boolean  @default(false)
	createdAt DateTime @default(now)
	updatedAt DateTime @updatedAt
}

@on(Task)
@permission(isAuth)
query<findMany> getTasks(filter: { title, isDone })

@on(Task)
@permission(isAuth)
query<create> createTask(data: { title })

@on(Task)
@permission(isAuth)
query<findUnique> getTaskById(where: id)

@on(Task)
@permission(isAuth, owns)
query<update> updateTaskById(where: id, data: { title, isDone })

@on(Task)
@permission(isAuth, owns)
query<delete> deleteTaskById(where: id)

component TaskComponent(task: Task) {
	render(
		<div className={ if task.isDone then "text-green-500" else "text-red-500" }>
			<div>{ task.title }</div>
			<div>{ if task.isDone then "YES" else "NO" }</div>
			<div>{ task.createdAt }</div>
		</div>
	)
}

@at("/")
@permission(isAuth)
page Home {
	let tasks = getTasks()

	render(
		<div>
			{ task }
			{
				if tasks.error then
					<div>{ "An error occured" }</div>
			}
			{
				if tasks.isLoading then
					<div>{ "Loading..." }</div>
				else
					if tasks.data.length == 0 then
						<div>{ "There are no tasks available" }</div>
					else
						for task in tasks.data =>
							<TaskComponent task={ task } />
			}
		</div>
	)
}
